백엔드를 모놀리식 아키텍쳐가 아니라 마이크로 서비스 아키텍쳐로 개발하면 
하나의 백엔드 인스턴스에서 다른 백엔드 인스턴스로 API를 호출하는 경우가 자주 있다. 
따라서 다른 백엔드 인스턴스의 API를 호출하기 위해 11장에서 설명하는 방법을 알아야 한다.

스프링에서는 REST API를 호출할 때 다음 세 가지 방법으로 수행한다.

> 1. **OpenFeign** : 책에서 가장 권하는 방법이다
2. **RestTemplate** : Deprecated지만, 사용 방법은 알아놓아야 한다.
3. **WebClient** : Spring에서 RestTemplate 대신 사용을 권하는 방법이다. 그러나 책에서 WebClient의 단점을 소개하고, OpenFeign을 권장하는 이유를 설명한다.

### 시나리오

![](https://velog.velcdn.com/images/calzone0404/post/0a8ce2cc-c1c5-4833-816a-aaa0c40bc3c9/image.jpg)

즉, 로컬에서 백엔드 앱, 결제 서비스 앱 총 2개의 프로젝트를 띄워서 실습하게 된다.

### 결제 서비스 앱

결제 서비스 앱은 단순하다. 그냥 POST 요청이 들어오면 단순히 그림에 있는 JSON 형식(맨 오른쪽에 있는거)을 반환해주는 Controller만 있으면 된다.

```java
// Payment Service APP
@RestController
public class PaymentsController {
	private static Logger logger = Logger.getLogger(PaymentsController.class.getName()); // 로그 찍으려고 사용
    
    @PostMapping("/payment")
    public ResponseEntity<Payment> createPayment(
    	@RequestHeader String requestId,
        @RequestBody Payment payment
    ) {
    	logger.info("요청 : " + requestId + " " + "payment.getAmount()");
        payment.setId(UUID,randomUUID().toString()); // UUID 설정
        return ResponseEntity
        		.status(HttpStatus.OK)
                .header("requestId", requestId)
                .body(payment);
    }
}
```

Payment 모델은 적절히 구현해주면 된다.

그리고 로컬 컴퓨터에서 이걸 실행하면 결제 시스템 앱은 8080번 포트를 점유하게 되는데, 다른 앱을 또 생성하게 되면 충돌이 나게 되므로 프론트로부터 요청을 전달받는 스프링 앱은 8081 포트를 사용하였다. (클라우드 환경에서 인스턴스 여러개 띄워서 테스트한다면 따로 설정해줄 필요 X)

# 11.1 스프링 클라우드 OpenFeign으로 REST 엔드포인트 호출하기



